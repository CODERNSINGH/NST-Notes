<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>LocalStorage Auth Demo</title>
    <style>
      body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;max-width:900px;margin:2rem auto;padding:1rem;color:#111}
      header{display:flex;align-items:center;gap:1rem}
      form{border:1px solid #ddd;padding:1rem;border-radius:8px;background:#fafafa}
      .grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
      label{display:block;font-size:.9rem;margin-top:.5rem}
      input[type=text],input[type=password]{width:100%;Padding:.5rem;margin-top:.25rem;border-radius:4px;border:1px solid #ccc}
      button{margin-top:.75rem;padding:.5rem .75rem;border-radius:6px;border:0;background:#0366d6;color:#fff}
      .note{background:#fffbe6;border:1px solid #ffe8a1;padding:.75rem;border-radius:6px;margin-top:1rem}
      pre{background:#0f1724;color:#e6eef8;padding:1rem;border-radius:6px;overflow:auto}
      .small{font-size:.9rem;color:#444}
    </style>
  </head>
  <body>
    <header>
      <h1>LocalStorage: Register & Login Demo</h1>
    </header>

    <p class="small">This page demonstrates storing and verifying username/password using <strong>localStorage</strong>. It's intended for classroom demonstration only — see security notes below.</p>

    <div class="grid">
      <section>
        <h2>Register</h2>
        <form id="registerForm">
          <label>Username
            <input id="regUsername" type="text" required />
          </label>
          <label>Password
            <input id="regPassword" type="password" required />
          </label>
          <button type="submit">Register (save to localStorage)</button>
          <div id="regMsg" class="small" aria-live="polite"></div>
        </form>

        <h2 style="margin-top:1rem">Storage Controls</h2>
        <div style="display:flex;gap:.5rem;align-items:center;flex-wrap:wrap">
          <button id="showBtn">Show Stored Users</button>
          <button id="clearBtn" style="background:#b91c1c">Clear Storage</button>
        </div>
        <pre id="storageView" style="margin-top:.75rem;min-height:120px">(click "Show Stored Users")</pre>
      </section>

      <section>
        <h2>Login</h2>
        <form id="loginForm">
          <label>Username
            <input id="loginUsername" type="text" required />
          </label>
          <label>Password
            <input id="loginPassword" type="password" required />
          </label>
          <button type="submit">Login (verify)</button>
          <div id="loginMsg" class="small" aria-live="polite"></div>
        </form>

        <div class="note">
          <strong>Teaching tip:</strong> For this demo we hash the password client-side using SHA-256 before storing it. This reduces the risk of storing plain text in the browser but <em>does not</em> make it production-safe. Discuss why server-side hashing (bcrypt/argon2), secure cookies, and HTTPS are required for real apps.
        </div>
      </section>
    </div>

    <script>
      // Simple helper: read users map from localStorage (username -> passwordHash)
      function getUsers(){
        try{
          const raw = localStorage.getItem('users') || '{}';
          return JSON.parse(raw);
        }catch(e){
          return {};
        }
      }
      function saveUsers(users){
        localStorage.setItem('users', JSON.stringify(users));
      }

      // Hash password with Web Crypto API (SHA-256) and return hex string
      async function hashPassword(password){
        const enc = new TextEncoder();
        const data = enc.encode(password);
        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        return hashArray.map(b => b.toString(16).padStart(2,'0')).join('');
      }

      // Register handler
      document.getElementById('registerForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const u = document.getElementById('regUsername').value.trim();
        const p = document.getElementById('regPassword').value;
        const msg = document.getElementById('regMsg');
        msg.textContent = '';
        if(!u || !p){ msg.textContent = 'Enter username and password.'; return; }
        const users = getUsers();
        if(users[u]){ msg.textContent = 'Username already exists. Choose another.'; return; }
        msg.textContent = 'Hashing password...';
        const h = await hashPassword(p);
        users[u] = h;
        saveUsers(users);
        msg.textContent = `Registered "${u}" — password hash stored.`;
        document.getElementById('registerForm').reset();
        renderStorage();
      });

      // Login handler
      document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const u = document.getElementById('loginUsername').value.trim();
        const p = document.getElementById('loginPassword').value;
        const msg = document.getElementById('loginMsg');
        msg.textContent = '';
        if(!u || !p){ msg.textContent = 'Enter username and password.'; return; }
        const users = getUsers();
        if(!users[u]){ msg.textContent = 'No such user. Please register first.'; return; }
        msg.textContent = 'Verifying...';
        const h = await hashPassword(p);
        if(h === users[u]){
          msg.textContent = `Login successful — welcome ${u}!`;
        }else{
          msg.textContent = 'Login failed — incorrect password.';
        }
        document.getElementById('loginForm').reset();
      });

      // Show storage
      function renderStorage(){
        const view = document.getElementById('storageView');
        const users = getUsers();
        // For teaching we display the stored map, so students can see the hashed values.
        view.textContent = JSON.stringify(users, null, 2);
      }

      document.getElementById('showBtn').addEventListener('click', () => renderStorage());

      // Clear storage (only the demo key)
      document.getElementById('clearBtn').addEventListener('click', () => {
        if(confirm('Clear demo users from localStorage?')){
          localStorage.removeItem('users');
          renderStorage();
        }
      });

      // Initial render
      renderStorage();
    </script>
  </body>
</html>
